# Basphere 사용자 시나리오

IDP 완성 시 (Stage 3) 예상되는 사용자 워크플로우입니다.

## 가입

### 플랫폼

- **사용자 포털**: Backstage
- **접속 방법**: 웹 브라우저

### 가입 요청

필요 정보:
- 사용자 ID
- 이메일 주소

### 가입 승인

1. 이메일로 승인 코드 발송
2. 사용자 포털에서 승인 코드 입력

## 로그인

### 로그인 요청

필요 정보:
- 사용자 ID
- 비밀번호
- 로그인 코드 (이메일 발송)

### 로그인 결과

| 결과 | 설명 |
|------|------|
| 성공 | 사용자 포털에 로그인 성공 메시지 표시 |
| 실패 | 사용자 ID/비밀번호/로그인 코드 오류 |

## 로그아웃

- **수동**: 로그아웃 버튼 클릭
- **자동**: 30분 미사용 시 자동 로그아웃

## 테넌트 생성

### 요청 정보

- 테넌트 이름
- 테넌트 설명

### 생성 시 제공되는 자원

| 자원 | 사양 |
|------|------|
| **네트워크 공간 1** | 10.0.1.0/24 |
| **네트워크 공간 2** | 10.0.2.0/24 |
| **테넌트 라우터** | OPNsense VM |

### 테넌트 라우터 사양

| 항목 | 값 |
|------|-----|
| OS | OPNsense |
| CPU | 2 vCPU |
| 메모리 | 4GB |
| 디스크 | 100GB |

### 테넌트 라우터 네트워크

| 인터페이스 | IP | DHCP | MTU |
|-----------|-----|------|-----|
| WAN | 최상위 라우터에서 DHCP 할당 | - | 1450 |
| LAN1 | 10.0.1.1/32 | enabled | 1450 |
| LAN2 | 10.0.2.1/32 | enabled | 1450 |

### 컴퓨트 리소스 할당량

| 자원 | 값 |
|------|-----|
| CPU | 32 vCPU |
| RAM | 96GB |

## Kubernetes 클러스터 생성

### 요청 정보

- 클러스터 이름
- 클러스터 설명

### 선택 사항

#### 클러스터 이미지

| 이미지 | 설명 |
|--------|------|
| Talos Linux | 보안 강화된 Kubernetes 전용 OS |
| Ubuntu | 범용 Linux |

#### 클러스터 타입

| 타입 | Control Plane | Worker Node | 용도 |
|------|--------------|-------------|------|
| **Development** | 1대 | 3대 | 개발/테스트 |
| **Production** | 3대 | 3대 | 운영 환경 |

#### 네트워크 위치

- 테넌트 네트워크 1: 10.0.1.0/24
- 테넌트 네트워크 2: 10.0.2.0/24

### 기본 구성 요소

| 구성 요소 | 기술 |
|----------|------|
| **CNI** | Cilium |
| **Ingress Controller** | Cilium Ingress Controller |
| **Storage Class (Block, RWO)** | VMware CSI |
| **Storage Class (NFS, RWX)** | Synology NAS CSI |

## VPN 사용

### 기술

WireGuard

### 용도

VPN은 내부 인프라 접근이 아니라, **아직 외부로 노출되지 않은 클러스터와 서비스에 접근**하기 위해 사용

### 접근 가능 자원

- Kubernetes 클러스터
- Kubernetes에서 제공하는 LB 서비스
- Ingress를 통한 내부 DNS에 등록된 서비스

## 현재 상태 (Stage 1)

현재 MVP(Stage 1)에서는 위 시나리오의 일부만 구현되어 있습니다:

| 기능 | Stage 1 | Stage 3 (목표) |
|------|---------|----------------|
| 사용자 등록 | 웹 폼 + 관리자 승인 | Backstage + 이메일 인증 |
| 로그인 | SSH 키 인증 | Backstage + MFA |
| 테넌트 | 사용자 = 테넌트 | 독립 테넌트 네트워크 |
| VM 생성 | CLI (create-vm) | Backstage UI |
| K8s 클러스터 | 미지원 | Cluster API |
| VPN | 미지원 | WireGuard |

## 관련 문서

- [비전](vision.md) - 프로젝트 목표
- [아키텍처](architecture.md) - 전체 시스템 아키텍처
- [로드맵](roadmap.md) - Stage별 계획
